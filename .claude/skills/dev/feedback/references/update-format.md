# DESIGN.md 更新フォーマット

## 更新履歴セクションの形式

```markdown
## 更新履歴

### {YYYY-MM-DD}: {story-slug}

**設計判断**:
- {決定内容}（理由: {理由}）
- {決定内容2}（理由: {理由2}）

**学んだこと**:
- {発見内容}
- {発見内容2}

**注意点**:
- {警告内容}
```

## 各項目の書き方

### 設計判断

**良い例**:
- JWTではなくセッションベース認証を採用（理由: サーバーサイドでの即時無効化が必要なため）
- バリデーションはZodを使用（理由: TypeScriptとの型連携が優れているため）
- エラーハンドリングはResult型パターンを採用（理由: 例外よりも明示的なエラー処理が可能なため）

**悪い例**:
- ❌ Zodを使った（理由なし）
- ❌ セッション認証にした（「なぜ」がない）

### 学んだこと

**良い例**:
- React Hook FormとZodの連携では、zodResolver を使用することでスキーマからの型推論が自動的に行われる
- useFormのmode: 'onBlur' 設定により、フィールドからフォーカスが外れた時点でバリデーションが実行される

**悪い例**:
- ❌ Zodは便利だった（具体性がない）
- ❌ React Hook Formを使った（何を学んだか不明）

### 注意点

**良い例**:
- パスワードバリデーションでは長さチェックを正規表現チェックより先に行うこと。順序が逆だとエラーメッセージが「Invalid format」になり、ユーザーに分かりにくい
- Zodのoptional()はundefinedを許容するが、空文字は許容しない。空文字も許容する場合は.or(z.literal(''))を追加する必要がある

**悪い例**:
- ❌ バリデーションに注意（何に注意か不明）
- ❌ 順序が大事（具体性がない）

## 更新の粒度

### 機能別DESIGN.md

全ての学習事項を詳細に記録:
- 小さな発見も記録
- 具体的なコード例も含めてOK
- ストーリー単位で追記

### 総合DESIGN.md

重要な判断のみを抽出:
- プロジェクト全体に影響する決定
- 他の機能にも適用できるパターン
- アーキテクチャレベルの判断

## 重複の統合

同じ内容が複数回記録された場合:

```markdown
### 2024-01-21: login-form, 2024-01-25: signup-form

**設計判断**:
- Zodバリデーションパターンを標準化
  - 初回: login-form で導入
  - 展開: signup-form にも適用
```

## 更新コマンド

```bash
# 機能別DESIGN.mdの確認
cat docs/features/{feature-slug}/DESIGN.md

# 総合DESIGN.mdの確認
cat docs/features/DESIGN.md

# 更新履歴の追記（Edit tool使用）
Edit({
  file_path: "docs/features/{feature-slug}/DESIGN.md",
  old_string: "## 更新履歴",
  new_string: "## 更新履歴\n\n### {date}: {story-slug}\n\n..."
})
```

## 総合DESIGN.md vs 機能DESIGN.md 判断基準

| 項目 | 総合DESIGN.mdに記載 | 機能DESIGN.mdのみ |
|------|---------------------|-------------------|
| アーキテクチャ決定 | ✅ | - |
| 技術スタック選定 | ✅ | - |
| 共通パターン発見 | ✅ | - |
| 機能固有の実装詳細 | - | ✅ |
| 一時的なワークアラウンド | - | ✅ |

## 総合DESIGN.md整理の観点（Phase 2c）

code-simplifierに渡す観点:

| カテゴリ | 確認項目 |
|----------|----------|
| 用語・表現 | 同じ概念に同じ用語を使えているか |
| セクション | 見出し構造が論理的で、ナビゲーションしやすいか |
| 冗長さ | 不要な重複や回りくどい表現が残っていないか |
| 将来の追記性 | 後から設計判断を追加しやすいフォーマットになっているか |
