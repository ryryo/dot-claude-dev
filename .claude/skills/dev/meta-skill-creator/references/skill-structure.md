# 構造仕様（§3）

> 18-skills.md §3 の要約
> **相対パス**: `references/skill-structure.md`
> **原典**: `docs/00-requirements/18-skills.md` §3

---

## 3.1 標準フォルダ構造

```
skill-name/
├── SKILL.md              # 必須: 中枢（500行以内推奨）
├── agents/               # 推奨: Task仕様書（実行直前にロード）
│   ├── task-1.md
│   └── task-n.md
├── scripts/              # 任意: 実行可能コード（Python/Bash/Node等）
│   └── log_usage.js     # 推奨: フィードバックループ用
├── references/           # 任意: 必要時に読む参照資料（知識の外部化）
└── assets/               # 任意: 出力で使用する素材（テンプレ/雛形等）
```

**運用指針**: agents/scripts/references/assets はゼロベースで選定し、目的に必要なものだけ作成する。空ディレクトリは作成しない。
**責務分離**: agents/scripts/references/assets は責務単位で分割し、1ファイル=1責務を基本とする。複数責務の同居を避ける。

**作成禁止ファイル**:

| ファイル名               | 理由                         |
| ------------------------ | ---------------------------- |
| README.md                | SKILL.mdに集約               |
| INSTALLATION_GUIDE.md    | 補助ドキュメント不要         |
| QUICK_REFERENCE.md       | 補助ドキュメント不要         |
| その他の補助ドキュメント | SKILL.md + references/で完結 |

---

## 3.2 SKILL.md 仕様

### 3.2.1 YAML Frontmatter

| フィールド      | 型       | 必須 | 説明                                       |
| --------------- | -------- | ---- | ------------------------------------------ |
| `name`          | string   | 必須 | スキル識別子（ハイフンケース、最大64文字） |
| `description`   | string   | 必須 | スキル説明と発動条件（最大1024文字）       |
| `allowed-tools` | string[] | 任意 | 許可ツール                                 |

### 3.2.2 name フィールドの規則

| 規則                     | 説明                       | 例             |
| ------------------------ | -------------------------- | -------------- |
| ハイフンケース           | 小文字、数字、ハイフンのみ | `my-skill` ○   |
| 最大64文字               | 長すぎる名前は不可         |                |
| 先頭・末尾にハイフン不可 |                            | `-my-skill-` × |
| 連続ハイフン不可         |                            | `my--skill` ×  |
| ディレクトリ名と一致     | フォルダ名と完全一致       |                |

### 3.2.3 description フィールド（最重要：トリガー設計）

**descriptionはスキルの主要なトリガーメカニズム**

| 規則                          | 説明                                                            |
| ----------------------------- | --------------------------------------------------------------- |
| 最大1024文字                  | 簡潔かつ包括的に                                                |
| 角括弧禁止                    | `<` `>` は使用不可                                              |
| 「何を」と「いつ」を含める    | 機能＋発動条件を必ず書く                                        |
| 本文に When to Use 不要       | 発動条件は description に集約                                   |
| アンカーは description に統合 | ドキュメント/リファレンス/スイーズ情報は Markdown禁止で埋め込む |

**description 記述形式（Markdown禁止版）**:

```yaml
description: |
  {{スキルの機能説明（2〜3行）}}

  Anchors:
  • {{ドキュメント/ルール/スキーマ/書籍名など}} / 適用: {{適用範囲}} / 目的: {{目的}}
  • {{目標達成に必要十分な個数を記述}}

  Trigger:
  {{発動条件を日本語で記述}}。
  {{キーワード1}}, ..., {{キーワードN}}
```

### 3.2.4 本文（Markdown Body）

| セクション              | 必須 | 説明                                         |
| ----------------------- | ---- | -------------------------------------------- |
| 概要                    | 必須 | 1-2文で目的                                  |
| ワークフロー            | 推奨 | Phase ベースの流れ（Task分割の案内を含める） |
| Task仕様（ナビ）        | 必須 | agents/ の各Taskをいつ呼ぶか、入出力は何か   |
| ベストプラクティス      | 必須 | すべきこと/避けるべきこと                    |
| リソース/スクリプト参照 | 推奨 | references/ scripts/ assets/ への導線        |

**行数制約**: 500行以内。超過時は references/ に分離。

---

## 3.3 agents/ ディレクトリ仕様

### 位置づけ

| 観点                 | 説明                                       |
| -------------------- | ------------------------------------------ |
| サブエージェント定義 | **ではない**（永続人格の定義ではない）     |
| Task仕様書           | 役割・入力・出力・制約・参照先を書く       |
| 読み込みタイミング   | 実行直前に、そのTask分だけまとめて読まれる |
| 重要性               | 軽量に保つ                                 |

**責務分離**: Taskは責務ごとに分離し、1 Task = 1 責務を基本とする。複数責務がある場合は Task を分割する。

### Task仕様書テンプレート（§3.3.2）

```markdown
# Task仕様書：{{Task名}}

## 1. メタ情報

- 名前: {{実在する専門家の名前}}
  > 注記: 思考様式の参照ラベル。本人を名乗らず、方法論のみ適用。

## 2. プロフィール

### 2.1 背景

### 2.2 目的

### 2.3 責務

## 3. 知識ベース

### 3.1 参考文献

## 4. 実行仕様

### 4.1 思考プロセス

### 4.2 チェックリスト

### 4.3 ビジネスルール（制約）

## 5. インターフェース

### 5.1 入力

### 5.2 出力
```

---

## 3.4 scripts/ ディレクトリ仕様

### 使用場面

| 場面                         | 説明                         |
| ---------------------------- | ---------------------------- |
| 同じコードを繰り返し書き直す | スクリプト化して再利用       |
| 決定論的な信頼性が必要       | AIの不確実性を排除           |
| 複雑な処理の確実な実行       | 冪等性を保証                 |
| 制約/品質条件を守る          | 検証スクリプトで自動チェック |

### 責務分離

- 1スクリプト=1責務（処理/検証）を基本とする
- 複数の目的がある場合はスクリプトを分割する

### 実装要件

| 要件       | 説明                   |
| ---------- | ---------------------- |
| 冪等性     | 何度実行しても同じ結果 |
| エラー出力 | stderr に詳細を出す    |
| 引数検証   | 必須引数を確認         |
| ヘルプ     | `-h`/`--help`          |
| 終了コード | 成功0、一般1、引数2…   |

### 終了コード規則

| 終了コード | 意味           |
| ---------- | -------------- |
| 0          | 成功           |
| 1          | 一般的エラー   |
| 2          | 引数エラー     |
| 3          | ファイル不在   |
| 4          | 検証失敗       |
| 5          | 依存関係エラー |

---

## 3.5 references/ ディレクトリ仕様

### 役割

| 観点                 | 説明                                                |
| -------------------- | --------------------------------------------------- |
| 知識の外部ストレージ | SKILL.md や agents/\*.md を軽量に保つための逃がし先 |
| 読み込み前提         | 「毎回読む前提」ではなく**必要時にだけ読む**        |

### 使用場面

| 場面                 | パス形式                                 |
| -------------------- | ---------------------------------------- |
| データベーススキーマ | `references/{{schema-name}}.md`          |
| APIドキュメント      | `references/{{api-name}}.md`             |
| ドメイン知識         | `references/{{domain-name}}.md`          |
| ポリシー・ルール     | `references/{{policy-name}}.md`          |
| ワークフローガイド   | `references/{{workflow-name}}.md`        |
| 出力パターン         | `references/{{output-type}}-patterns.md` |

### ベストプラクティス

| プラクティス             | 説明                                      |
| ------------------------ | ----------------------------------------- |
| SKILL.md を軽量に保つ    | 詳細は references/                        |
| 重複を避ける             | 情報は SKILL.md か references/ のどちらか |
| 大きなファイル（>10k語） | SKILL.md に検索パターンを含める           |
| 100行超のファイル        | 先頭に目次                                |
| 責務単位で分割           | 1ファイル=1責務（ドメイン/目的単位）      |

---

## 3.6 assets/ ディレクトリ仕様

### 役割

コンテキストに読み込むためではなく、**Claude が生成する出力で使用するファイル**

### 使用場面

| 場面             | パス形式                           |
| ---------------- | ---------------------------------- |
| テンプレート     | `assets/{{template-name}}.{{ext}}` |
| 画像・アイコン   | `assets/{{image-name}}.{{ext}}`    |
| ボイラープレート | `assets/{{boilerplate-name}}/`     |
| フォント         | `assets/{{font-name}}.{{ext}}`     |
| サンプルデータ   | `assets/{{data-name}}.{{ext}}`     |

**責務分離**: assets/ は用途/責務単位で分割し、1アセット=1用途を基本とする。

---

## 関連リソース

- **仕様概要**: See [spec-overview.md](spec-overview.md) - §1-2
- **ワークフロー**: See [workflow-patterns.md](workflow-patterns.md) - §4
- **命名規則**: See [naming-conventions.md](naming-conventions.md) - §9-10
