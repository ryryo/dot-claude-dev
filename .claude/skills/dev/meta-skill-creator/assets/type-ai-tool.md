# AI Tool スクリプトテンプレート指示

> **読み込み条件**: type === "ai-tool" の場合
> **対応ランタイム**: Bash, Node.js, Python

---

## 目的

外部AIサービス（Claude, OpenAI等）と連携するスクリプトを生成する。

---

## AIへの実装指示

### 必須機能

1. **AI呼び出し**
   - プロンプト送信
   - レスポンス受信
   - ストリーミング対応（対応サービスの場合）

2. **認証**
   - APIキーの環境変数読み込み
   - 認証エラーの適切な処理

3. **プロンプト管理**
   - テキストプロンプト
   - ファイルからのプロンプト読み込み
   - システムプロンプト設定

4. **出力処理**
   - コンソール出力
   - ファイル出力
   - JSON形式での構造化出力

### 対応サービス

| サービス | CLI | API |
|----------|-----|-----|
| Claude | claude CLI | Anthropic API |
| OpenAI | - | OpenAI API |

### 引数仕様

| 引数 | 必須 | 説明 |
|------|------|------|
| --prompt | △ | プロンプトテキスト |
| --file | △ | プロンプトファイル |
| --system | × | システムプロンプト |
| --model | × | 使用モデル |
| --output | × | 出力先ファイル |
| --max-tokens | × | 最大トークン数 |

### 環境変数

- `{{ANTHROPIC_API_KEY}}`: Claude API用
- `{{OPENAI_API_KEY}}`: OpenAI API用

---

## コード構造の指示

AIは以下の構造でコードを生成してください:

```
1. サービス検出
   - 利用可能なAPIキー確認
   - CLIの存在確認

2. ユーティリティ関数
   - loadPrompt(): プロンプト読み込み
   - callAI(): AI呼び出し
   - handleStream(): ストリーミング処理
   - formatResponse(): レスポンス整形

3. サービス別実装
   - callClaude(): Claude呼び出し
   - callOpenAI(): OpenAI呼び出し

4. メイン処理
   - 引数パース
   - プロンプト準備
   - AI呼び出し
   - 結果出力
```

---

## 品質基準

AIは以下の基準を満たすコードを生成してください:

- [ ] APIキー未設定時の明確なエラー
- [ ] レート制限への対応
- [ ] 長いプロンプトの分割処理
- [ ] APIエラーの詳細ログ
- [ ] コスト考慮（トークン数制限）
