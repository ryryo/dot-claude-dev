# API Client スクリプトテンプレート指示

> **読み込み条件**: type === "api-client" の場合
> **対応ランタイム**: Node.js, Python, TypeScript

---

## 目的

外部REST/GraphQL APIを呼び出すスクリプトを生成する。

---

## AIへの実装指示

### 必須機能

1. **HTTPリクエスト実行**
   - GET/POST/PUT/DELETE/PATCHメソッドをサポート
   - リクエストヘッダーのカスタマイズ
   - リクエストボディのJSON送信

2. **認証処理**
   - Bearer Token認証
   - API Key認証（ヘッダーまたはクエリパラメータ）
   - 環境変数からの認証情報読み込み

3. **エラーハンドリング**
   - HTTPステータスコードに応じた処理
   - ネットワークエラーのキャッチ
   - タイムアウト処理

4. **リトライ機能**
   - 一時的なエラー時の自動リトライ
   - 指数バックオフ
   - レート制限（429）への対応

### 推奨依存関係

| ランタイム | 推奨パッケージ |
|------------|----------------|
| Node.js | 組み込みfetch, ofetch, ky |
| Python | httpx, requests |
| TypeScript/Bun | 組み込みfetch |

### 環境変数

- `{{API_BASE_URL}}`: APIのベースURL
- `{{API_KEY}}`: APIキー（必要な場合）
- `{{API_TIMEOUT}}`: タイムアウト（ミリ秒、デフォルト30000）

### 引数仕様

| 引数 | 必須 | 説明 |
|------|------|------|
| --url または --endpoint | ○ | リクエスト先URL/エンドポイント |
| --method | × | HTTPメソッド（デフォルト: GET） |
| --data | × | リクエストボディ（JSON文字列またはファイルパス） |
| --output | × | 出力先ファイルパス |
| --headers | × | 追加ヘッダー（JSON形式） |

### 出力形式

- 成功時: JSONレスポンスを標準出力または指定ファイルに出力
- エラー時: エラー情報を標準エラー出力

---

## コード構造の指示

AIは以下の構造でコードを生成してください:

```
1. インポート
   - HTTPクライアント
   - ファイル操作（出力用）
   - 環境変数読み込み

2. 設定
   - デフォルト値定義
   - 終了コード定数

3. ユーティリティ関数
   - createClient(): HTTPクライアント初期化
   - makeRequest(): リクエスト実行
   - handleResponse(): レスポンス処理
   - retryWithBackoff(): リトライ処理

4. メイン処理
   - 引数パース
   - クライアント初期化
   - リクエスト実行
   - 結果出力
```

---

## 品質基準

AIは以下の基準を満たすコードを生成してください:

- [ ] 環境変数が未設定の場合の適切なエラーメッセージ
- [ ] HTTPエラーの詳細なログ出力
- [ ] 大きなレスポンスの効率的な処理
- [ ] 機密情報のログ出力防止
- [ ] タイムアウトの適切な設定
