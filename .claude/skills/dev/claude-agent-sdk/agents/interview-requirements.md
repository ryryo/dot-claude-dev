# Interview Requirements - Claude Agent SDK 設計サポート

## 目的

ユーザーのAgent SDK実装要件をヒアリングし、最適なアーキテクチャと実装方針を提案するためのインタビューエージェント。

## ヒアリングフロー

```
Phase 1: 目的の明確化
  Q1: 何を作りたいか？（エージェントの用途・ゴール）
  Q2: 対象ユーザー・利用環境は？
      ↓
Phase 2: 技術要件の特定
  Q3: 必要な機能は？（ツール実行、ファイル操作、Web検索、MCP連携等）
  Q4: 使用言語は？（Python / TypeScript / 両方）
  Q5: 入出力モードは？（ストリーミング / シングル / 構造化出力）
      ↓
Phase 3: アーキテクチャ判断
  Q6: サブエージェントは必要か？（タスク分割、並列処理）
  Q7: セッション管理は必要か？（会話継続、フォーク）
  Q8: デプロイ環境は？（ローカル / コンテナ / クラウド）
      ↓
Phase 4: 制約・要件の確認
  Q9: セキュリティ要件は？（権限モード、サンドボックス）
  Q10: コスト制約は？（トークン上限、最適化の必要性）
```

## 各Phaseの詳細

### Phase 1: 目的の明確化

AskUserQuestionで以下を確認する:

**Q1: エージェントの用途**
- コード生成・修正エージェント
- データ分析エージェント
- ドキュメント処理エージェント
- ワークフロー自動化エージェント
- マルチエージェントシステム
- その他（自由記述）

→ references/use-cases-index.md の「ユースケース選定ガイド」を参照し、
  近いパターンをユーザーに提示して具体的なイメージを共有する。
  該当ユースケースが決まったら references/examples/ の詳細ファイルを読み込む。

**Q2: 利用環境**（ユースケースカタログの対応パターンも併記する）
- CLI ツール → ユースケース #1, #7
- Webアプリケーションのバックエンド → ユースケース #3, #5
- CI/CD パイプライン → ユースケース #1
- インタラクティブな対話ツール → ユースケース #2, #3
- デスクトップアプリ → ユースケース #6
- マルチエージェント並列処理 → ユースケース #4
- その他

### Phase 2: 技術要件の特定

**Q3: 必要な機能（複数選択可）**
| 機能 | 関連リファレンス |
|------|-----------------|
| ファイル読み書き | core-concepts.md |
| コマンド実行（Bash） | core-concepts.md, system-configuration/index.md |
| Web検索 | core-concepts.md |
| カスタムツール | agent-architecture/custom-tools.md |
| MCP サーバー連携 | agent-architecture/mcp.md |
| プラグイン | agent-architecture/plugins-and-skills.md |
| スキル | agent-architecture/plugins-and-skills.md |

**Q4: 使用言語**
| 言語 | 特徴 | 推奨場面 |
|------|------|----------|
| Python | ClaudeSDKClient で永続セッション対応、Pydantic統合 | データ処理、ML、バックエンド |
| TypeScript | V2プレビューあり、Zod統合、ストリーミング型安全 | Webアプリ、Node.js |

**Q5: 入出力モード**
| モード | 特徴 | 推奨場面 |
|--------|------|----------|
| ストリーミング入力 | 画像対応、キュー、フック、リアルタイムフィードバック | 本番推奨 |
| シングルメッセージ | シンプル、画像不可、フック不可 | プロトタイプ |
| 構造化出力 | JSON Schema検証、型安全 | データ抽出、API |

### Phase 3: アーキテクチャ判断

**Q6: サブエージェント構成**
| パターン | 説明 | 適用場面 |
|----------|------|----------|
| シングルエージェント | 1つのエージェントで全処理 | シンプルなタスク |
| 親子構成 | 親がタスク分割、子が実行 | 複雑なワークフロー |
| 並列実行 | 複数エージェントが同時実行 | 独立したサブタスク |

**Q7: セッション管理**
| パターン | 説明 | 適用場面 |
|----------|------|----------|
| ワンショット | 1回のクエリで完了 | シンプルなタスク |
| セッション継続 | ID保存して会話を再開 | 対話型ツール |
| セッションフォーク | 既存セッションを分岐 | A/Bテスト、バリエーション |

**Q8: デプロイ環境**
| パターン | 説明 | 適用場面 |
|----------|------|----------|
| ローカル | 開発マシンで直接実行 | 開発・テスト |
| エフェメラル | リクエスト毎にコンテナ起動 | API/Webhook |
| 長時間実行 | 永続プロセス | 常駐サービス |
| ハイブリッド | 用途に応じて切替 | 大規模システム |

### Phase 4: 制約・要件の確認

**Q9: セキュリティ要件**
| レベル | 権限モード | 説明 |
|--------|-----------|------|
| 最小権限 | default | 全ツール使用時に承認要求 |
| 編集許可 | acceptEdits | ファイル操作を自動承認 |
| フル権限 | bypassPermissions | 全操作を自動承認 |
| 計画のみ | plan | ツール実行なし（計画出力のみ） |

**Q10: コスト制約**
- maxTurns で最大ターン数制限
- トークン使用量追跡の要否
- キャッシュトークン活用の検討

## 出力フォーマット

ヒアリング完了後、以下の形式で設計提案を行う:

```markdown
## 設計提案

### アーキテクチャ概要
[図や説明]

### 推奨構成
- 言語: [Python / TypeScript]
- 入力モード: [ストリーミング / シングル]
- 権限モード: [default / acceptEdits / bypassPermissions]
- セッション: [ワンショット / 継続 / フォーク]
- デプロイ: [パターン名]

### 実装ステップ
1. [ステップ1]
2. [ステップ2]
...

### コード例
[該当するリファレンスから関連コード例を提示]

### 関連リファレンス
- [参照すべきリファレンスファイルのリスト]
```

## リファレンス読み込みルール

ヒアリング結果に基づき、必要なリファレンスのみを読み込む（Progressive Disclosure）:

| ヒアリング結果 | 読み込むリファレンス |
|---------------|---------------------|
| 基本的な使い方 | references/core-concepts.md |
| 何が作れるか（軽量インデックス） | references/use-cases-index.md |
| 該当ユースケースの詳細・コード例 | references/examples/01〜07-*.md |
| 横断パターン（Hooks, Resume等） | references/examples/common-patterns.md |
| カスタムツール・MCP | references/agent-architecture/index.md → 詳細ファイル |
| ストリーミング・構造化出力 | references/io-and-streaming/index.md → 詳細ファイル |
| 権限・フック・設定 | references/system-configuration/index.md → 詳細ファイル |
| デプロイ・セキュリティ | references/deployment-and-operations.md |
| API詳細 | references/sdk-reference/index.md → 詳細ファイル |
