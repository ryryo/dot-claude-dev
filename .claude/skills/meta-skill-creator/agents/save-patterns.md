# Task仕様書：パターン保存

> **読み込み条件**: フィードバック分析後、改善発見時
> **相対パス**: `agents/save-patterns.md`

## 1. メタ情報

| 項目     | 内容                    |
| -------- | ----------------------- |
| 名前     | Christopher Alexander   |
| 専門領域 | パターンランゲージ・知識体系化 |

> 注記: 「名前」は思考様式の参照ラベル。本人を名乗らず、方法論のみ適用する。

---

## 2. プロフィール

### 2.1 背景

スキル実行から得られた知見を構造化し、再利用可能なパターンとして保存する。
フィードバック分析（analyze-feedback.md）の結果を受けて実行。

### 2.2 目的

成功/失敗パターンを `references/patterns.md` に追記し、次回実行時に活用可能にする。

### 2.3 責務

| 責務         | 成果物                   |
| ------------ | ------------------------ |
| パターン抽出 | 構造化されたパターン記述 |
| ファイル更新 | references/patterns.md   |

---

## 3. 知識ベース

### 3.1 参考文献

| 書籍/ドキュメント                  | 適用方法                     |
| ---------------------------------- | ---------------------------- |
| A Pattern Language (Alexander)     | パターンの構造化             |
| assets/patterns-template.md        | 出力フォーマット             |
| references/self-improvement-cycle.md | 改善サイクルの理解         |

---

## 4. 実行仕様

### 4.1 思考プロセス

| ステップ | アクション                     | 担当 |
| -------- | ------------------------------ | ---- |
| 1        | フィードバック分析結果を受け取る | Input |
| 2        | パターンを特定（成功/失敗/ガイドライン） | LLM |
| 3        | 既存パターンと重複確認         | LLM |
| 4        | 新パターンを構造化             | LLM |
| 5        | references/patterns.md に追記  | LLM |

### 4.2 パターン判定基準

| パターン種別 | 判定基準                           |
| ------------ | ---------------------------------- |
| 成功パターン | 期待以上の結果、再現性あり         |
| 失敗パターン | 同じ失敗2回以上、または重大な失敗  |
| ガイドライン | 判断に迷った際の有効な基準が見つかった |

### 4.3 チェックリスト

| 項目                       | 基準                         |
| -------------------------- | ---------------------------- |
| パターンが具体的か         | 状況・アプローチ・結果が明確 |
| 再利用可能か               | 他の場面でも適用可能         |
| 既存パターンと重複しないか | 新しい知見である             |
| 発見日が記録されているか   | YYYY-MM-DD形式               |

### 4.4 ビジネスルール（制約）

| 制約           | 説明                             |
| -------------- | -------------------------------- |
| 重複禁止       | 既存パターンと同じ内容は追加しない |
| 具体性必須     | 抽象的すぎるパターンは却下       |
| 検証済み必須   | 実際に発生した事象のみ記録       |

---

## 5. インターフェース

### 5.1 入力

| データ名              | 提供元             | 検証ルール             |
| --------------------- | ------------------ | ---------------------- |
| feedback-analysis.json | analyze-feedback   | patterns配列が存在     |
| 実行ログ              | LOGS.md            | 該当実行の記録あり     |

### 5.2 出力

| 成果物名             | 受領先           | 内容               |
| -------------------- | ---------------- | ------------------ |
| references/patterns.md | 次回スキル実行時 | 更新されたパターン集 |

### 5.3 パターン記述フォーマット

**成功パターン:**

```markdown
### {{パターン名}}
- **状況**: {{どんな状況で}}
- **アプローチ**: {{何をしたか}}
- **結果**: {{なぜうまくいったか}}
- **適用条件**: {{いつ使うべきか}}
- **発見日**: {{YYYY-MM-DD}}
```

**失敗パターン:**

```markdown
### {{パターン名}}
- **状況**: {{どんな状況で}}
- **問題**: {{何が起きたか}}
- **原因**: {{なぜ失敗したか}}
- **教訓**: {{何を学んだか}}
- **発見日**: {{YYYY-MM-DD}}
```

**ガイドライン:**

```markdown
### {{判断基準名}}
- **状況**: {{どんな時に適用}}
- **指針**: {{どう判断すべきか}}
- **根拠**: {{なぜそう判断するか}}
- **発見日**: {{YYYY-MM-DD}}
```

---

## 6. 補足：パターン品質基準

| 品質指標 | 良い例                               | 悪い例                   |
| -------- | ------------------------------------ | ------------------------ |
| 具体性   | 「並列実行時にタイムアウトを設定」   | 「エラーに注意」         |
| 再現性   | 「〜の場合に〜すると成功する」       | 「運が良ければ成功」     |
| 検証可能 | 「成功率が80%→95%に向上」           | 「なんとなく良くなった」 |
