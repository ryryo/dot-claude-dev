{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "title": "Feedback Record",
  "description": "フィードバック記録の形式スキーマ",
  "type": "object",
  "required": ["skillName", "timestamp", "result"],
  "properties": {
    "skillName": {
      "type": "string",
      "description": "スキル名"
    },
    "timestamp": {
      "type": "string",
      "format": "date-time",
      "description": "記録日時"
    },
    "result": {
      "type": "string",
      "enum": ["success", "failure", "partial", "skipped"],
      "description": "実行結果"
    },
    "execution": {
      "type": "object",
      "properties": {
        "phase": {
          "type": "string",
          "description": "実行フェーズ"
        },
        "task": {
          "type": "string",
          "description": "実行タスク"
        },
        "agent": {
          "type": "string",
          "description": "実行エージェント"
        },
        "script": {
          "type": "string",
          "description": "実行スクリプト"
        },
        "duration": {
          "type": "integer",
          "description": "実行時間（ミリ秒）"
        }
      }
    },
    "input": {
      "type": "object",
      "properties": {
        "userRequest": {
          "type": "string",
          "description": "ユーザー要求"
        },
        "parameters": {
          "type": "object",
          "description": "入力パラメータ"
        }
      }
    },
    "output": {
      "type": "object",
      "properties": {
        "artifacts": {
          "type": "array",
          "items": { "type": "string" },
          "description": "生成された成果物"
        },
        "changes": {
          "type": "array",
          "items": { "type": "string" },
          "description": "変更内容"
        }
      }
    },
    "quality": {
      "type": "object",
      "properties": {
        "validationPassed": {
          "type": "boolean",
          "description": "検証パスしたか"
        },
        "errorCount": {
          "type": "integer",
          "description": "エラー数"
        },
        "warningCount": {
          "type": "integer",
          "description": "警告数"
        },
        "coveragePercent": {
          "type": "number",
          "minimum": 0,
          "maximum": 100,
          "description": "カバレッジ率"
        }
      }
    },
    "feedback": {
      "type": "object",
      "properties": {
        "notes": {
          "type": "string",
          "description": "補足メモ"
        },
        "issues": {
          "type": "array",
          "items": {
            "type": "object",
            "properties": {
              "type": { "type": "string", "enum": ["error", "warning", "suggestion"] },
              "message": { "type": "string" },
              "location": { "type": "string" }
            }
          },
          "description": "発見された問題"
        },
        "improvements": {
          "type": "array",
          "items": { "type": "string" },
          "description": "改善提案"
        },
        "userSatisfaction": {
          "type": "integer",
          "minimum": 1,
          "maximum": 5,
          "description": "ユーザー満足度（1-5）"
        }
      }
    },
    "selfImprovement": {
      "type": "object",
      "properties": {
        "triggered": {
          "type": "boolean",
          "description": "自己改善がトリガーされたか"
        },
        "suggestions": {
          "type": "array",
          "items": {
            "type": "object",
            "properties": {
              "target": { "type": "string" },
              "type": { "type": "string", "enum": ["prompt", "workflow", "schema", "template"] },
              "description": { "type": "string" },
              "priority": { "type": "string", "enum": ["high", "medium", "low"] }
            }
          },
          "description": "自己改善提案"
        },
        "applied": {
          "type": "array",
          "items": { "type": "string" },
          "description": "適用された改善"
        }
      }
    },
    "metrics": {
      "type": "object",
      "properties": {
        "totalUsageCount": {
          "type": "integer",
          "description": "累計使用回数"
        },
        "successCount": {
          "type": "integer",
          "description": "成功回数"
        },
        "failureCount": {
          "type": "integer",
          "description": "失敗回数"
        },
        "successRate": {
          "type": "number",
          "minimum": 0,
          "maximum": 1,
          "description": "成功率"
        },
        "averageDuration": {
          "type": "integer",
          "description": "平均実行時間"
        },
        "currentLevel": {
          "type": "integer",
          "minimum": 1,
          "maximum": 4,
          "description": "現在のスキルレベル"
        }
      }
    }
  },
  "additionalProperties": false
}
