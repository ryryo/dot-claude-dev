# Deployer スクリプトテンプレート指示

> **読み込み条件**: type === "deployer" の場合
> **対応ランタイム**: Bash, Node.js

---

## 目的

デプロイ操作を行うスクリプトを生成する。

---

## AIへの実装指示

### 必須機能

1. **ファイル転送**
   - SSH/SCP によるファイル転送
   - rsync による差分同期
   - 権限の保持

2. **リモート操作**
   - リモートコマンド実行
   - サービス再起動
   - ヘルスチェック

3. **デプロイ戦略**
   - Blue-Green デプロイ
   - ローリングアップデート
   - カナリアリリース

4. **ロールバック**
   - 前バージョンへの復元
   - バックアップ管理

### 推奨依存関係

| ランタイム | 推奨パッケージ |
|------------|----------------|
| Bash | ssh, rsync, scp |
| Node.js | ssh2, rsync |

### 環境変数

- `{{DEPLOY_HOST}}`: デプロイ先ホスト
- `{{DEPLOY_USER}}`: SSHユーザー
- `{{DEPLOY_KEY}}`: SSH鍵パス
- `{{DEPLOY_PATH}}`: デプロイ先パス

### 引数仕様

| 引数 | 必須 | 説明 |
|------|------|------|
| --target | ○ | デプロイ対象（staging/production） |
| --source | ○ | デプロイ元ディレクトリ |
| --dry-run | × | 実行せずにプレビュー |
| --rollback | × | ロールバック実行 |
| --no-restart | × | サービス再起動をスキップ |

### 出力形式

- デプロイ結果のサマリーを出力

---

## コード構造の指示

AIは以下の構造でコードを生成してください:

```
1. インポート
   - SSH/転送ライブラリ
   - ファイル操作

2. 設定
   - 環境別設定
   - 終了コード定数

3. ユーティリティ関数
   - connect(): SSH接続
   - syncFiles(): ファイル同期
   - executeRemote(): リモートコマンド
   - healthCheck(): ヘルスチェック
   - rollback(): ロールバック

4. メイン処理
   - 引数パース
   - 接続確立
   - デプロイ実行
   - ヘルスチェック
   - 結果報告
```

---

## 品質基準

AIは以下の基準を満たすコードを生成してください:

- [ ] デプロイ前のバックアップ
- [ ] 失敗時の自動ロールバック
- [ ] 詳細なログ出力
- [ ] 接続タイムアウトの設定
- [ ] 機密情報のログ出力防止
