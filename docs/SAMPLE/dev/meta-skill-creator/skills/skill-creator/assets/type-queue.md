# Queue スクリプトテンプレート指示

> **読み込み条件**: type === "queue" の場合
> **対応ランタイム**: Node.js, Python

---

## 目的

メッセージキュー操作を行うスクリプトを生成する。

---

## AIへの実装指示

### 必須機能

1. **メッセージ操作**
   - メッセージ送信（publish/enqueue）
   - メッセージ受信（subscribe/dequeue）
   - メッセージ確認（acknowledge）

2. **キュー管理**
   - キュー作成
   - キュー削除
   - キュー状態確認

3. **ジョブ管理**
   - ジョブ投入
   - ジョブ状態確認
   - ジョブリトライ

4. **モニタリング**
   - キュー長取得
   - 処理中ジョブ数
   - 失敗ジョブ確認

### 推奨依存関係

| ランタイム | 推奨パッケージ |
|------------|----------------|
| Node.js | bullmq, amqplib |
| Python | celery, pika, rq |

### 環境変数

- `{{QUEUE_URL}}`: キュー接続URL
- `{{QUEUE_NAME}}`: デフォルトキュー名

### 引数仕様

| 引数 | 必須 | 説明 |
|------|------|------|
| --action | ○ | send/receive/status/retry |
| --queue | × | キュー名 |
| --message | △ | メッセージ（sendアクション時） |
| --job-id | △ | ジョブID（status/retryアクション時） |
| --wait | × | 受信待機時間（秒） |

### 出力形式

- 操作結果をJSON形式で出力

---

## コード構造の指示

AIは以下の構造でコードを生成してください:

```
1. インポート
   - キュークライアント
   - JSON操作

2. 設定
   - 接続設定
   - 終了コード定数

3. ユーティリティ関数
   - connect(): 接続確立
   - sendMessage(): メッセージ送信
   - receiveMessage(): メッセージ受信
   - getStatus(): ステータス取得
   - retryJob(): ジョブリトライ

4. メイン処理
   - 引数パース
   - 接続確立
   - アクション実行
   - 結果出力
   - 接続クローズ
```

---

## 品質基準

AIは以下の基準を満たすコードを生成してください:

- [ ] 接続エラーの適切な処理
- [ ] メッセージの確実な配信
- [ ] デッドレターキューの考慮
- [ ] グレースフルシャットダウン
- [ ] 重複処理の防止
