# Claude Codeで推奨される「テスト駆動ワークフロー」実践ガイド

## 参考
- https://x.com/riku720720/status/2013452742241698127
- https://www.anthropic.com/engineering/claude-code-best-practices

## 概要

このワークフローは、Claude CodeのエンジニアチームがGitHub上で推奨している開発手法で、従来のTDD（テスト駆動開発）を**AI時代に最適化**したアプローチです。

### 目的
- 長期的なテスト資産の蓄積ではなく、**1機能を完成させるまでの評価プロセス**をAIが自律的に実行できるようにすること
- 仕様のブレを防ぎ、実装の質を担保すること

---

## ワークフローの4ステップ

### ステップ1: テストファースト（仕様の固定）

**指示内容:**
```
TDDでテストだけ書いて。
実装は書かない。モック実装も作らない。
テスト実行して落ちるのを確認。
```

**ポイント:**
- 入出力ペアだけを渡す
- 最初に**失敗するテストログ**を取得することで、仕様が明確化・固定される
- この段階では実装コードは一切書かない

**効果:**
- 仕様のブレを防止
- AIと開発者の認識合わせ
- 明確なゴール設定

---

### ステップ2: テストのコミット

**作業内容:**
- 作成されたテストコードをレビュー
- 納得できる内容であれば、テストのみを先行コミット

**重要性:**
- テストを先に確定させることで、実装フェーズでの仕様変更を防ぐ
- バージョン管理上、テストが実装より先に存在する状態を作る

---

### ステップ3: 実装の反復（テスト固定）

**指示内容:**
```
テストは一切変えないで、
全部通るまで実装→テストを反復
```

**プロセス:**
1. 実装コードを書く
2. テストを実行
3. 失敗があれば実装を修正
4. 全テストが通るまで繰り返す

**実績データ:**
- 通常2〜4周で収束
- テストは絶対に変更しない（仕様のブレ防止）

---

### ステップ4: 品質チェックと最終コミット

**チェック項目:**
```
この実装、テストに過剰適合してない？
抜け道ない？
```

**確認ポイント:**
- **過剰適合（Overfitting）**: テストケースだけに最適化された実装になっていないか
- **抜け道**: テストをすり抜ける不具合やエッジケースがないか
- コードの品質と保守性

**OKなら:**
- 実装をコミット

---

## テスト資産の管理

### 最終判断

実装完了後、テストコードの扱いを決定:

| 判断基準 | アクション |
|---------|-----------|
| **長期的な価値がある** | テスト資産として保持・維持 |
| **一時的な価値のみ** | テストを簡素化、または削除 |

**考え方:**
- すべてのテストを残す必要はない
- 開発プロセスでの役割を終えたテストは積極的に整理する
- メンテナンスコストとのバランスを考慮

---

## フロントエンド開発におけるTDDの適用範囲

### TDDが効果的な領域

フロントエンド開発では、**すべてをTDDで開発するのではなく**、以下の領域に絞って適用することが推奨されます。

#### ✅ TDD適用推奨（仕様が明確で安定している部分）

**1. ビジネスロジック層**
- バリデーション、計算ロジック、データ変換
- 仕様が明確で入出力が定義可能
- 変更頻度が低く、テストの投資対効果が高い

**2. カスタムフック・ユーティリティ関数**
- 汎用的な機能（useDebounce、useLocalStorage等）
- 再利用性が高く、テストの価値が長期的に持続
- 入出力が明確で、テストが書きやすい

**3. 状態管理ロジック**
- Redux reducer、Zustand store等のステート管理
- ビジネスルールの中核を担う
- 状態遷移の正確性が重要

**4. APIクライアント層**
- データフェッチ、エラーハンドリング、リトライロジック
- ネットワーク層の信頼性向上に直結
- モック化が比較的容易

---

### TDDが非効率な領域

#### ❌ TDD適用非推奨（目視確認が必要な部分）

**1. UI/UXコンポーネントの見た目**
- レイアウト、スタイリング、アニメーション
- レスポンシブデザイン
- 視覚的品質は「テスト」ではなく「目視確認」が効率的

**2. 仕様が流動的な機能**
- プロトタイプ開発、探索的UI開発
- ステークホルダーのフィードバックで頻繁に変更される部分
- テストを先に書いても、すぐに陳腐化する

**3. 一度きりの実装**
- 特定プロジェクト固有のページ・コンポーネント
- テストのメンテナンスコストが価値を上回る

---

## 実践的な開発フロー例

### パターン1: ロジック部分のみTDD

```
1. 「フォームバリデーションのテストだけ書いて」
2. テストレビュー → OKならコミット
3. 「テスト通るまでバリデーション実装して」
4. 全テスト通過 → 実装コミット
5. 「このバリデーションを使うフォームコンポーネント作って」
   → UI部分はテストなしで実装、ブラウザで目視確認
```

### パターン2: UI先行、ロジック後付け

```
1. 「まず画面全体を実装して（テストなし）」
2. ブラウザで確認、UI調整
3. 「ビジネスロジック部分だけ、テスト書いてからリファクタして」
   → 重要部分だけ後からTDD適用
```

---

## TDD適用判断の基準

| 基準 | TDD向き | TDD不向き |
|------|---------|-----------|
| **仕様の明確性** | 入出力が明確に定義可能 | 見た目やUXで判断 |
| **変更頻度** | 仕様が安定している | 頻繁に変更される |
| **テスト表現性** | アサーションで表現可能 | 視覚的判断が必要 |
| **影響範囲** | ビジネスロジック | プレゼンテーション層 |
| **投資対効果** | テストの価値が長期的 | テストコストが価値を上回る |

---

## Anthropic公式推奨事項との関連

[公式ベストプラクティス](https://www.anthropic.com/engineering/claude-code-best-practices)では、以下の点が強調されています:

### テストファーストの重要性
- AIに明確な成功基準を与えることで、自律的な問題解決が可能になる
- テストは「何を作るか」の最も明確な仕様書

### 反復的アプローチ
- AIは一度で完璧な実装を生成できないことを前提とする
- テストを軸にした反復により、確実に目標に到達

### 品質保証
- AIが生成したコードの盲点を発見するため、人間によるレビューが不可欠
- 特に「テストをパスするだけ」の実装になっていないか注意

---

## このワークフローの利点

### 1. 仕様のブレ防止
最初にテストを固定することで、実装中の仕様変更を防ぐ

### 2. AI評価の自律化
テストがあることで、AIが自分で実装の正しさを判断可能

### 3. 効率的な開発
2〜4周という予測可能な反復回数で収束

### 4. 柔軟なテスト管理
必要なテストだけを残し、メンテナンスコストを最適化

### 5. 品質担保
過剰適合チェックにより、実用的な実装を保証

### 6. フロントエンド開発への適合
UI部分は目視確認、ロジック部分はTDDと明確に切り分けることで、効率的な品質担保が可能

---

## 実践のコツ

### 入出力ペアの準備
- できるだけ具体的で明確な例を用意
- エッジケースも含める

### テストレビューの視点
- 仕様を正しく表現しているか
- 過不足なくカバーしているか
- 実行可能で信頼できるか

### 反復時の注意
- テストは絶対に変更しない原則を守る
- 各反復でのログを確認し、進捗を把握

### 過剰適合の見抜き方
- テストケース以外の入力で動作するか想像する
- エッジケースや境界値での挙動を確認
- コードの汎用性と拡張性を評価

### フロントエンド開発での適用
- **ロジック層とUI層を明確に分離**する設計を心がける
- ロジック部分はTDD、UI部分は実装後の目視確認という切り分けを徹底
- テストコストと価値のバランスを常に意識

---

## まとめ

このワークフローは、従来のTDDをAI開発に最適化したもので、**テストを評価ツール**として活用することで、AIの自律的な開発を可能にします。

特にフロントエンド開発においては、**すべてをTDDで開発するのではなく**、ビジネスロジック層やユーティリティ関数など、仕様が明確で安定している部分に絞ってTDDを適用することが重要です。

UI/UXコンポーネントの見た目や、仕様が流動的な部分については、実装後のブラウザでの目視確認が効率的であり、無理にテストを書く必要はありません。

重要なのは、テストを「資産」としてではなく、**開発プロセスのガイドレール**として捉え、適用範囲と目的を明確にした上で、柔軟に管理することです。