# フィードバックループ（§7）

> 18-skills.md §7 の要約
> **相対パス**: `references/feedback-loop.md`
> **原典**: `docs/00-requirements/18-skills.md` §7

---

## 7.1 目的

スキルが使用されるたびにフィードバックを収集し、継続的に改善する仕組みを提供する。

---

## 7.2 実装方式

**採用方式**: エージェント責務方式（明示的な記録フェーズ）

| 特性           | 説明                                                 |
| -------------- | ---------------------------------------------------- |
| 確実性         | 最も高い（ワークフローに組み込むため記録漏れがない） |
| 不確実性排除   | スクリプトで確実に実行                               |
| メンテナンス性 | 高い（エージェントテンプレートで標準化）             |

---

## 7.3 標準ログスクリプト: log_usage.js

**ファイル**: `scripts/log_usage.js`

### 責務

| 処理           | 説明                                                 |
| -------------- | ---------------------------------------------------- |
| 実行記録の追記 | 使用履歴をログファイルに記録                         |
| メトリクス更新 | 使用回数・成功率を更新                               |
| レベル評価     | 現在のメトリクスがレベルアップ条件を満たすかチェック |

### 引数

| 引数       | 必須 | 説明                       |
| ---------- | ---- | -------------------------- |
| `--result` | 必須 | `success` または `failure` |
| `--phase`  | 任意 | 実行したフェーズ名         |
| `--agent`  | 任意 | 実行したエージェント名     |
| `--notes`  | 任意 | 追加のフィードバックメモ   |

### 使用形式

```bash
node scripts/log_usage.js \
  --result {{success|failure}} \
  --phase "{{phase-name}}" \
  --agent "{{agent-name}}"
```

### 使用例

**成功時**:

```bash
node scripts/log_usage.js \
  --result success \
  --phase "Phase 4" \
  --agent "skill-creator"
```

**失敗時（ノート付き）**:

```bash
node scripts/log_usage.js \
  --result failure \
  --phase "Phase 3" \
  --notes "検証エラー: name フィールドが不正"
```

---

## 7.4 更新されるファイル

### LOGS.md

実行記録が追記される：

```markdown
## [2025-12-31T10:00:00.000Z]

- **Agent**: skill-creator
- **Phase**: Phase 4
- **Result**: ✓ 成功
- **Notes**: なし

---
```

### EVALS.json

メトリクスが更新される：

```json
{
  "skill_name": "skill-creator",
  "current_level": 1,
  "metrics": {
    "total_usage_count": 10,
    "success_count": 8,
    "failure_count": 2,
    "last_evaluated": "2025-12-31T10:00:00.000Z"
  }
}
```

---

## 7.5 レベルアップ条件

スキルは使用実績に基づいて自動的にレベルアップする：

| レベル | 名称         | 最小使用回数 | 最小成功率 |
| ------ | ------------ | ------------ | ---------- |
| 1      | Beginner     | 0            | 0%         |
| 2      | Intermediate | 5            | 60%        |
| 3      | Advanced     | 15           | 75%        |
| 4      | Expert       | 30           | 85%        |

**レベルアップ時の動作**:

| 順序 | 処理                                                 |
| ---- | ---------------------------------------------------- |
| 1    | EVALS.json の `current_level` を更新                 |
| 2    | コンソールにレベルアップ通知を表示                   |
| 3    | SKILL.md の `level` フィールドを更新（存在する場合） |
| 4    | CHANGELOG.md に自動エントリを追加（存在する場合）    |

---

## 7.6 ベストプラクティス

### すべきこと

| プラクティス                              | 理由                       |
| ----------------------------------------- | -------------------------- |
| ワークフローの最終フェーズで必ず記録      | 記録漏れを防ぐ             |
| 失敗時は `--notes` で具体的な原因を記録   | 改善のためのデータを蓄積   |
| 定期的に LOGS.md を確認し、パターンを分析 | 継続的改善のサイクルを維持 |

### 避けるべきこと

| アンチパターン               | 問題                           |
| ---------------------------- | ------------------------------ |
| フィードバック記録をスキップ | データが蓄積されない           |
| 成功/失敗の判断を曖昧にする  | メトリクスの信頼性が低下       |
| 記録なしでスキルを改善する   | データ駆動の改善が維持できない |

---

## 関連リソース

- **作成プロセス**: See [creation-update-process.md](creation-update-process.md) - §6
- **品質基準**: See [quality-standards.md](quality-standards.md) - §8
