# Webhook スクリプトテンプレート指示

> **読み込み条件**: type === "webhook" の場合
> **対応ランタイム**: Node.js, Python

---

## 目的

Webhook受信・送信処理を行うスクリプトを生成する。

---

## AIへの実装指示

### 必須機能

1. **Webhook送信**
   - POSTリクエストでペイロード送信
   - 署名ヘッダーの生成（HMAC-SHA256）
   - リトライ機能

2. **Webhook受信（サーバーモード）**
   - 署名検証
   - ペイロードのパース
   - イベントタイプに応じた処理分岐

3. **セキュリティ**
   - シークレットによる署名検証
   - リプレイ攻撃対策（タイムスタンプ検証）

4. **エラーハンドリング**
   - 検証失敗時の適切なレスポンス
   - ログ出力

### 推奨依存関係

| ランタイム | 推奨パッケージ |
|------------|----------------|
| Node.js | 組み込みcrypto, express（受信時） |
| Python | hmac, hashlib, flask/fastapi（受信時） |

### 環境変数

- `{{WEBHOOK_SECRET}}`: 署名検証用シークレット
- `{{WEBHOOK_URL}}`: 送信先URL
- `{{WEBHOOK_PORT}}`: 受信用ポート（サーバーモード時）

### 引数仕様

| 引数 | 必須 | 説明 |
|------|------|------|
| --mode | ○ | send または receive |
| --payload | △ | 送信するペイロード（sendモード時必須） |
| --event-type | × | イベントタイプ識別子 |

### 出力形式

- 送信成功時: レスポンスステータスを標準出力
- 受信時: 処理結果をJSON形式で出力

---

## コード構造の指示

AIは以下の構造でコードを生成してください:

```
1. インポート
   - 暗号化ライブラリ
   - HTTPクライアント/サーバー

2. 設定
   - シークレット読み込み
   - 終了コード定数

3. ユーティリティ関数
   - generateSignature(): 署名生成
   - verifySignature(): 署名検証
   - sendWebhook(): Webhook送信
   - handleWebhook(): Webhook受信処理

4. メイン処理
   - モード判定
   - 送信/受信処理実行
```

---

## 品質基準

AIは以下の基準を満たすコードを生成してください:

- [ ] 署名検証の正確な実装
- [ ] タイムスタンプの検証（オプション）
- [ ] ペイロードサイズの制限
- [ ] 適切なHTTPステータスコード返却
- [ ] シークレットのログ出力防止
