{
  "story_id": "deck-shuffle-api",
  "title": "デッキ生成・シャッフルAPI",
  "description": "バックエンドとして、占いを始めるときに78枚のタロットカード（大アルカナ22枚、小アルカナ56枚）がシャッフルされた状態でAPIから提供する。毎回異なる占い結果を得られるようにする。",
  "purpose": "占いセッション開始時に、ランダムにシャッフルされた78枚のタロットデッキを提供し、毎回異なる占い結果を可能にする",
  "goals": [
    "78枚のタロットカード（大アルカナ22枚、小アルカナ56枚）のデータ構造を定義する",
    "デッキをシャッフルするロジックを実装する",
    "シャッフルされたデッキを返すAPIエンドポイントを提供する",
    "毎回異なる順序でカードが提供されることを保証する"
  ],
  "scope": {
    "in_scope": [
      "タロットカードのデータ構造定義（78枚：大アルカナ22枚、小アルカナ56枚）",
      "デッキシャッフルアルゴリズムの実装",
      "デッキ生成・シャッフルAPIエンドポイントの実装",
      "ランダム性の保証"
    ],
    "out_of_scope": [
      "カード画像の管理",
      "カードの意味・解釈データ",
      "ユーザー認証・セッション管理",
      "占い結果の保存",
      "フロントエンド実装"
    ]
  },
  "acceptance_criteria": [
    {
      "criterion": "78枚のカードデータが正しく定義されている",
      "verification": "大アルカナ22枚、小アルカナ56枚（各スート14枚×4スート）が含まれていることをテストで確認"
    },
    {
      "criterion": "APIからシャッフルされたデッキが取得できる",
      "verification": "APIエンドポイントを呼び出すと78枚のカードがランダムな順序で返される"
    },
    {
      "criterion": "毎回異なる順序でカードが返される",
      "verification": "複数回APIを呼び出した際に、カードの順序が異なることを確認（統計的検証）"
    },
    {
      "criterion": "すべてのカードが重複なく含まれる",
      "verification": "シャッフル後のデッキに78枚すべてが含まれ、重複がないことをテストで確認"
    }
  ],
  "technical_context": {
    "architecture": "Next.js API Routes",
    "language": "TypeScript",
    "validation": "Zod",
    "testing": "Vitest"
  },
  "assumptions": [
    "タロットカードは標準的な78枚構成（大アルカナ22枚、小アルカナ56枚）を使用",
    "小アルカナは4スート（ワンド、カップ、ソード、ペンタクル）各14枚（1-10、ペイジ、ナイト、クイーン、キング）",
    "正位置・逆位置の判定は別ストーリーで実装",
    "APIはステートレス（セッション管理なし）"
  ],
  "dependencies": [
    "TypeScriptプロジェクト初期化（init-project）"
  ],
  "risks": [
    {
      "risk": "乱数生成の品質が低く、偏りが発生する可能性",
      "mitigation": "Fisher-Yatesシャッフルなど実績のあるアルゴリズムを使用"
    }
  ]
}
