# TODO: カード抽選API (card-draw-api)

## T1: APIレスポンス型定義

**分類**: TASK（型定義・設定）

- [ ] [TASK][EXEC] APIレスポンス型定義を作成（Card, Position, Orientation, DrawResponse等）
- [ ] [TASK][VERIFY] 型定義が正しくエクスポートされているか確認

---

## T2: カード抽選ロジック実装（重複なし3枚）

**分類**: TDD（ビジネスロジック、入出力明確、アサーション可能）

- [ ] [TDD][RED] カード抽選ロジック（重複なし3枚）のテスト作成
  - 3枚が返されること
  - 重複がないこと
  - 元の配列から選ばれること
  - 空配列や不足時のエラー処理
- [ ] [TDD][GREEN] カード抽選ロジックの実装
- [ ] [TDD][REFACTOR] カード抽選ロジックのリファクタリング
- [ ] [TDD][REVIEW] セルフレビュー（過剰適合チェック、エッジケース確認）
- [ ] [TDD][CHECK] lint/format/build

---

## T3: 正位置/逆位置ランダム設定ロジック

**分類**: TDD（ビジネスロジック、入出力明確、アサーション可能）

- [ ] [TDD][RED] 正位置/逆位置ランダム設定ロジックのテスト作成
  - upright または reversed が返されること
  - ランダム性の検証（モック/シード固定）
- [ ] [TDD][GREEN] 正位置/逆位置ランダム設定ロジックの実装
- [ ] [TDD][REFACTOR] 正位置/逆位置ランダム設定ロジックのリファクタリング
- [ ] [TDD][REVIEW] セルフレビュー（過剰適合チェック、エッジケース確認）
- [ ] [TDD][CHECK] lint/format/build

---

## T4: ポジション割り当てロジック

**分類**: TDD（データ変換ロジック、入出力明確、アサーション可能）

- [ ] [TDD][RED] ポジション割り当てロジックのテスト作成
  - 1枚目: past
  - 2枚目: present
  - 3枚目: future
  - 配列長が3でない場合のエラー処理
- [ ] [TDD][GREEN] ポジション割り当てロジックの実装
- [ ] [TDD][REFACTOR] ポジション割り当てロジックのリファクタリング
- [ ] [TDD][REVIEW] セルフレビュー（過剰適合チェック、エッジケース確認）
- [ ] [TDD][CHECK] lint/format/build

---

## T5: カード抽選サービス統合

**分類**: TDD（ビジネスロジック統合、入出力明確、アサーション可能）

- [ ] [TDD][RED] カード抽選サービス統合のテスト作成
  - 3枚のカードが返されること
  - 各カードにposition（past/present/future）が設定されていること
  - 各カードにorientation（upright/reversed）が設定されていること
  - 重複がないこと
- [ ] [TDD][GREEN] カード抽選サービス統合の実装
- [ ] [TDD][REFACTOR] カード抽選サービス統合のリファクタリング
- [ ] [TDD][REVIEW] セルフレビュー（過剰適合チェック、エッジケース確認）
- [ ] [TDD][CHECK] lint/format/build

---

## T6: 3枚引きAPIエンドポイント実装

**分類**: E2E（HTTP API、実際のリクエスト/レスポンス確認が必要）

- [ ] [E2E][IMPL] 3枚引きAPIエンドポイント実装（POST /api/tarot/draw）
  - ルーティング設定
  - コントローラ実装
  - サービス呼び出し
  - レスポンス返却
- [ ] [E2E][AUTO] agent-browser/HTTPクライアントで検証
  - POST /api/tarot/draw が200を返すこと
  - レスポンスが適切なJSON形式であること
  - 3枚のカード情報が含まれること
  - position, orientationが正しく設定されていること
- [ ] [E2E][CHECK] lint/format/build

---

## T7: エラーハンドリング実装

**分類**: TDD（エラー処理ロジック、入出力明確、アサーション可能）

- [ ] [TDD][RED] エラーハンドリングのテスト作成
  - 不正なリクエストで400を返すこと
  - 内部エラーで500を返すこと
  - エラーレスポンスに適切なメッセージが含まれること
- [ ] [TDD][GREEN] エラーハンドリングの実装
- [ ] [TDD][REFACTOR] エラーハンドリングのリファクタリング
- [ ] [TDD][REVIEW] セルフレビュー（過剰適合チェック、エッジケース確認）
- [ ] [TDD][CHECK] lint/format/build

---

## T8: APIドキュメント作成

**分類**: TASK（ドキュメント作成）

- [ ] [TASK][EXEC] APIドキュメント作成（エンドポイント仕様、リクエスト/レスポンス形式）
- [ ] [TASK][VERIFY] ドキュメントが正しく記述されているか確認

---

## 実装の流れ

1. **T1**: 型定義（TASK）
2. **T2-T4**: 各ロジック単位でTDD
3. **T5**: ロジック統合をTDD
4. **T6**: APIエンドポイント実装をE2E検証
5. **T7**: エラーハンドリングをTDD
6. **T8**: ドキュメント作成（TASK）

## 備考

- カードマスターデータは別ストーリーで用意されている前提
- T2-T5はロジック層のため、モックデータで独立してテスト可能
- T6はHTTP層のため、実際のサーバー起動とHTTPリクエストで検証
- ランダム性のテストはシード固定やモックを活用
